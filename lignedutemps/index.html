<!DOCTYPE html>
<!-- Copyright 2017 Kevin F.S. avec un peu d'aide de sa meilleure moiti√© -->
<!-- Ce projet peut contenir de brefs extraits de code qui proviennent √† notre connaissance du domaine public -->
<html lang="fr">
    <head>
        <title>üé∫ Jazz √† Montr√©al üé∫</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://fonts.googleapis.com/css?family=Arima+Madurai:700|Nunito|Open+Sans" rel="stylesheet">
        <link href="style.css" rel="stylesheet">
        <link rel="apple-touch-icon" href="apple-touch-icon.png"> <!-- ic√¥ne pour iOS -->
        <script src="jquery-3.2.1.min.js"></script>
        <script src="jquery-ui.min.js"></script> <!-- impl√©mente les √©l√©ments coulissants -->
        <script src="jquery.ui.touch-punch.min.js"></script>  <!-- support pour les √©crans tactiles -->
        <script src="html2canvas.min.js"></script> <!-- impl√©mente des captures d'√©cran -->
        <script>
            $( function() {
                // d√©finit une classe d'√©l√©ments coulissants
                $( ".evenement" ).draggable({
                    // aimant√© √† l'int√©rieur des cases vides
                    snap: ".cible",
                    snapMode: "inner",
                    // fixe la position des √©l√©ments coulissants par rapport au hublot
                    // pour √©viter qu'ils ne se prom√®nent "tout seuls" si le hublot est redimensionn√©
                    stop: function(e, ui) {
                        var w = Math.max(document.documentElement.clientWidth, window.innerWidth || 0); // largeur du hublot en px = 100vw
                        var h = Math.max(document.documentElement.clientHeight, window.innerHeight || 0); // hauteur du hublot en px = 100vh
                        var x = ui.position.left / w * 100;
                        ui.helper.css('left', x + 'vw');
                        var y = ui.position.top / h * 100;
                        ui.helper.css('top', y + 'vh');
                    } 
                });
            } );
        </script>
    </head>
    <body>

        <a class="lien" href="#" id="sauvegarder">Valider</a> <!-- capture l'√©cran dans un canvas invisible-->
        <a class="lien" id="telecharger" target="resultat">T√©l√©charger</a> <!-- enregistre le canvas pr√©c√©dent dans une image PNG-->

        <script>
            document.getElementById('sauvegarder').addEventListener('click', function() {
                
                var correct = 0; // compteur des r√©ponses justes
                for (var i = 1; i <= 8; i++) {
                    e = document.getElementById("e" + i).getBoundingClientRect();
                    c = document.getElementById("c" + i).getBoundingClientRect();
                    // vrai si les √©l√©ments et leur cible correspondant se touchent
                    var overlap = !(c.right < e.left || c.left > e.right || c.bottom < e.top || c.top > e.bottom);
                        if (overlap) {
                            correct++;
                        }
                    }
                
                for (var i = 1; i <= 8; i++) {
                    if (correct === 8) {
                    document.getElementById("e" + i).style.border = "1vw solid #72A156"; // tout est bon = bordure verte
                    } else {
                        document.getElementById("e" + i).style.border = "1vw solid #DD912F"; // bordure normale
                    }
                }
                
                html2canvas(document.getElementById("travail")).then(function(canvas) {
                    canvas.setAttribute("id", "canvas"); // pour pouvoir le manipuler plus tard bien qu'il soit invisible
                    canvas.setAttribute("style", "display:none;");
                    // remplace le canvas existant, le cas √©ch√©ant
                    if (document.getElementById('canvas') === null) {
                        document.body.appendChild(canvas);
                    } else {
                        document.body.replaceChild(canvas, document.getElementById('canvas'));
                    }
                    // enregistre le canvas en PNG sous le nom de l'√©l√®ve
                    document.getElementById('telecharger').href = document.getElementById("canvas").toDataURL();
                    document.getElementById('telecharger').download = "Travail " + document.getElementById('nom').value + ".png";
                });
            }, false);
        </script>

        <div id="travail"> <!-- le div qui sera captur√© par html2canvas -->
        
            <h1><a href="http://jazzpetitebourgognedoc.radio-canada.ca/ligne-du-temps/13" target="_blank">Le Jazz √† Montr√©al</a></h1>
            <!-- ce champ d√©termine aussi le nom du fichier t√©l√©charg√©-->
            <div id="eleve">Nom de l'√©l√®ve&nbsp;:&nbsp;<input id="nom" type="text" name="fullname" maxlength="35"></div>

            <div class="rangee" id="r1"> <!-- 1re rang√©e de cases vides avec √©tiquettes d'ann√©es -->
                <div class="casevide" style="left: 2vw;">
                    <!-- l'image de fond d√©passe de l'√©l√©ment afin de pouvoir l'aligner √† notre go√ªt -->
                    <div class="cible" id="c1" style="background: url('1896.jpg') no-repeat center top/auto 60vh;"></div>
                    <div class="annee">1896</div>
                    <div class="trait"></div> <!-- reliant la case √† la ligne du temps -->
                </div>
                <div class="casevide" style="left: 10vw;">
                    <div class="cible" id="c2" style="background: url('1917.jpg') no-repeat center top/auto 60vh;"></div>
                    <div class="annee">1917</div>
                    <div class="trait"></div>
                </div>
                <div class="casevide" style="left: 18vw;">
                    <div class="cible" id="c3" style="background: url('1945.jpg') no-repeat center/auto 60vh;"></div>
                    <div class="annee">1945</div>
                    <div class="trait"></div>
                </div>
                <div class="casevide" style="left: 26vw;">
                    <div class="cible" id="c4" style="background: url('1967.jpg') no-repeat center/auto 60vh;"></div>
                    <div class="annee">1967</div>
                    <div class="trait"></div>
                </div>
            </div>
            
            <div id="ligne"></div>  <!--notre "ligne du temps" qui s√©pare la page -->

            <div class="rangee" id="r2">  <!-- 2e rang√©e de cases vides avec √©tiquettes d'ann√©es -->
                <div class="casevide" style="left: 14vw;">
                    <div class="trait"></div>
                    <div class="annee">1902</div>                    
                    <div class="cible" id="c5" style="background: url('1902.jpg') no-repeat left top/auto 60vh;"></div>
                </div>
                <div class="casevide" style="left: 22vw;">
                    <div class="trait"></div>
                    <div class="annee">1933</div>
                    <div class="cible" id="c6" style="background: url('1933.jpg') no-repeat center/auto 60vh;"></div>    
                </div>
                <div class="casevide" style="left: 30vw;">
                    <div class="trait"></div>
                    <div class="annee">1958</div>
                    <div class="cible" id="c7" style="background: url('1958.png') no-repeat center/auto 60vh;"></div>
                </div>
                <div class="casevide" style="left: 38vw;">
                    <div class="trait"></div>
                    <div class="annee">1980</div>
                    <div class="cible" id="c8" style="background: url('1980.jpg') no-repeat center center/auto 60vh;"></div>
                </div>
            </div>

            

            <div class="rangee" id="r3"> <!-- 1re rang√©e de cases coulissantes avec les r√©ponses -->
                <div class="evenement" id="e6">
                    <div class="tableau">
                        <h3>L‚Äôorchestre de Myron Sutton</h3>
                        <p>Parti d‚ÄôOntario, le groupe appel√© les Canadian Ambassadors s‚Äôinstalle √† Montr√©al.</p>
                    </div>
                </div>
                <div class="evenement" id="e2">
                    <div class="tableau">
                        <h3>Tout premier enregistrement de jazz</h3>
                        <p>L‚Äôorchestre Original Dixieland Jazz Band enregistre le tout premier disque de jazz.</p>
                    </div>
                </div>
                <div class="evenement" id="e1">
                    <div class="tableau">
                        <h3>Projection du premier film en Am√©rique du Nord</h3>
                        <p>C‚Äôest l‚Äô√©poque du cin√©ma muet. Des musiciens jouent alors que le film est projet√©.</p>
                    </div>
                </div>
                <div class="evenement" id="e4">
                    <div class="tableau">
                        <h3>Expo 67</h3>
                        <p>Lors de l‚ÄôExpo 67, plusieurs musiciens de jazz font des spectacles.</p>
                    </div>
                </div>
            </div>
            <div class="rangee" id="r4"> <!-- 2e rang√©e de cases coulissantes avec les r√©ponses -->
                <div class="evenement" id="e3">
                    <div class="tableau">
                        <h3>Premier enregistrement d‚Äôun montr√©alais c√©l√®bre</h3>
                        <p>Le montr√©alais Oscar Peterson enregistre son premier disque.</p>
                    </div>
                </div>
                
                <div class="evenement" id="e5">
                    <div class="tableau">
                        <h3>Invention du jazz</h3>
                        <p>Jelly Roll Merton a m√©lang√© des styles de musique (le ragtime, le quadrille et le blues). Il a cr√©√© le jazz.</p>
                    </div>
                </div>
                <div class="evenement" id="e8">
                    <div class="tableau">
                        <h3>Festival international de jazz de Montr√©al</h3>
                        <p>Sur l‚Äô√Æle Sainte-H√©l√®ne, le premier Festival international de jazz se d√©roule. </p>
                    </div>
                </div>
                <div class="evenement" id="e7">
                    <div class="tableau">
                        <h3>Premi√®re √©dition du Festival de jazz</h3>
                        <p>√Ä Montr√©al, Oscar Peterson et The Modern Jazz Quartet sont les vedettes du premier Festival de jazz.</p>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>